# ディレクトリ構成.md

## 🎯 目的

このプロジェクトは「迷路×INVADER」ゲームと、そのAI開発のためのAPIを提供するWebアプリケーションである。以下はその開発・運用を支えるディレクトリ構成案である。

---

## 📁 ディレクトリ構成

## フロントエンド（frontend）

```
frontend/
├── app/                    # Next.js App Router
│   ├── layout.tsx         # ルートレイアウト（メタデータ、フォント設定）
│   ├── page.tsx           # トップページ（新規ゲーム作成、AI開発リンク）
│   ├── globals.css        # グローバルスタイル（Tailwind CSS設定）
│   └── game/              # ゲーム関連のルート
│       ├── layout.tsx     # ゲームページのレイアウト（GameProvider）
│       ├── page.tsx       # 新規ゲーム作成ページ
│       └── [gameId]/      # 動的ルーティング（ゲームID別）
│           └── page.tsx   # ゲームページのコンテンツ
├── components/            # 共通コンポーネント
│   ├── ui/               # 基本UIコンポーネント（shadcn/ui）
│   │   ├── button.tsx    # ボタンコンポーネント
│   │   ├── card.tsx      # カードコンポーネント
│   │   └── progress.tsx  # プログレスバーコンポーネント
│   └── game/             # ゲーム関連コンポーネント
│       ├── GameCanvas.tsx    # ゲームキャンバス（迷路描画）
│       ├── GameControls.tsx  # ゲームコントロール（移動・攻撃）
│       ├── GameHeader.tsx    # ゲームヘッダー（タイトル・リセット）
│       ├── GameStatus.tsx    # ゲームステータス（プレイヤー情報）
│       └── GameProvider.tsx  # ゲーム状態管理プロバイダー
├── lib/                  # ユーティリティ関数
│   └── utils.ts         # 共通ユーティリティ（cn関数等）
├── store/               # 状態管理
│   └── gameStore.ts    # ゲーム状態管理ストア（Zustand）
├── public/             # 静的ファイル
├── next.config.js      # Next.js設定
├── tailwind.config.ts  # Tailwind CSS設定
├── postcss.config.js   # PostCSS設定
├── package.json        # 依存関係管理
└── tsconfig.json       # TypeScript設定
```

## バックエンド（backend）

```
backend/
├── src/                    # ソースコード
│   ├── index.ts           # エントリーポイント
│   ├── app.ts             # Express アプリケーション設定
│   ├── config/            # 設定ファイル
│   ├── controllers/       # コントローラー
│   │   ├── gameController.ts    # ゲーム管理コントローラー
│   │   ├── aiController.ts      # AI管理コントローラー
│   │   └── authController.ts    # 認証コントローラー
│   ├── models/            # データモデル
│   │   ├── game.ts        # ゲームモデル
│   │   ├── player.ts      # プレイヤーモデル
│   │   └── maze.ts        # 迷路モデル
│   ├── routes/            # ルート定義
│   │   ├── game.ts        # ゲーム関連ルート
│   │   ├── ai.ts          # AI関連ルート
│   │   └── auth.ts        # 認証ルート
│   ├── middleware/        # ミドルウェア
│   │   ├── auth.ts        # 認証ミドルウェア
│   │   └── errorHandler.ts # エラーハンドリング
│   ├── services/          # サービス
│   │   ├── gameService.ts  # ゲームサービス
│   │   └── aiService.ts    # AIサービス
│   └── utils/             # ユーティリティ
│       ├── errors.ts       # エラー定義
│       └── logger.ts       # ロギング
├── ai-runner/            # AI実行環境
│   ├── Dockerfile        # AIコンテナ定義
│   ├── runner.py         # AI実行スクリプト
│   └── sdk/              # AI開発用SDK
├── package.json          # 依存関係管理
└── tsconfig.json         # TypeScript設定
```

### 実装済みの主要機能

1. **ゲーム画面**
   - 迷路の描画（Canvas）
   - プレイヤーの位置表示
   - ターン制の実装
   - 移動・攻撃コントロール
   - ゲーム状態の表示

2. **状態管理**
   - Zustandによるゲーム状態管理
   - 複数ゲームセッションのサポート
   - 型安全な状態更新

3. **UI/UX**
   - レスポンシブデザイン
   - ダークモード対応
   - アニメーション効果
   - アクセシブルなコンポーネント

4. **ルーティング**
   - 動的ルーティングによるゲームセッション管理
   - レイアウトの共有
   - クライアントサイドナビゲーション

5. **バックエンド**
   - ゲーム状態管理API
   - AIプレイヤーの自動追加機能
   - AIコンテナの自動起動機能
   - AIからのアクション実行API

### 技術スタック

- **フロントエンド**
  - **フレームワーク**: Next.js 14.1.3（App Router）
  - **言語**: TypeScript
  - **スタイリング**: Tailwind CSS
  - **状態管理**: Zustand
  - **UIコンポーネント**: shadcn/ui（Radix UIベース）
  - **アニメーション**: tailwindcss-animate
  - **ユーティリティ**: uuid（ゲームID生成）

- **バックエンド**
  - **フレームワーク**: Node.js (Express)
  - **言語**: TypeScript
  - **データベース**: PlanetScale (MySQL)
  - **AI実行環境**: Docker + Python
  - **認証**: JWT

### 注意事項

1. すべてのクライアントコンポーネントには`'use client'`ディレクティブが必要
2. サーバーコンポーネントとクライアントコンポーネントの適切な分離
3. 状態管理はクライアントコンポーネントでのみ使用
4. APIルートは`app/api/`ディレクトリに配置
5. ゲームセッションはURLパラメータ（`gameId`）で識別
6. 各ゲームセッションは独立して管理され、同時に複数のゲームをプレイ可能

---

## 💡 備考

* `ai-runner` はAIスクリプト専用の安全な実行環境であり、バックエンドから起動・制御される。
* `docs/` に設計ドキュメントを蓄積し、部内レビュー・コンテスト提出に備える。
* `docker-compose` により一括起動が可能。
* 複数のゲームセッションを同時に管理可能な設計により、複数ユーザーによる同時プレイをサポート。
* AIプレイヤーの自動追加と自動行動機能により、ゲームモード選択時に適切なプレイヤー構成が自動的に設定される。

この構成により、開発チームの分業や保守性を高めつつ、AIの分離実行やセキュリティ対策を明確化できる。また、複数ゲームセッションの管理により、スケーラブルなゲーム体験を提供できる。
